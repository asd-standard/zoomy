<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Tiling System &#8212; PyZui 0.11 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=5ecbeea2" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css?v=12dfc556" />
    <link rel="stylesheet" type="text/css" href="_static/custom.css?v=cc7d0dec" />
    <script src="_static/documentation_options.js?v=086c1757"></script>
    <script src="_static/doctools.js?v=9bcbadda"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Logging System" href="logging.html" />
    <link rel="prev" title="Tiled media object" href="tiledmediaobject.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="tiling-system">
<h1>Tiling System<a class="headerlink" href="#tiling-system" title="Link to this heading">¶</a></h1>
<p>This document provides a comprehensive overview of the tiling system architecture,
explaining how large images are converted into pyramidal tile structures and how
such tiles are stored to be then retrieved and rendered on the interface.</p>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Link to this heading">¶</a></h2>
<p>The tiling system is responsible for:</p>
<ol class="arabic simple">
<li><p>Converting large images into pyramidal tile structures</p></li>
<li><p>Storing tiles on disk for persistence</p></li>
<li><p>Caching tiles in memory for fast access</p></li>
<li><p>Providing tiles on demand for display</p></li>
</ol>
<p>The system uses a <strong>tile pyramid</strong> structure where each level represents the image
at a different zoom level. Level 0 contains a single overview tile, and higher
levels contain progressively more tiles at higher resolutions.</p>
</section>
<section id="architecture">
<h2>Architecture<a class="headerlink" href="#architecture" title="Link to this heading">¶</a></h2>
<p>The tiling system consists of the following components:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>┌─────────────────────────────────────────────────────────────────┐
│                        TileManager                              │
│  (Coordinates tile requests, caching, and provider routing)     │
└─────────────────────────────────────────────────────────────────┘
            │                                    │
            ▼                                    ▼
┌─────────────────────┐              ┌─────────────────────┐
│     TileCache       │              │    TileProviders    │
│  (Memory caching)   │              │ (Tile loading/gen)  │
└─────────────────────┘              └─────────────────────┘
                                                │
                                      ┌─────────┼──────────────┐
                                      ▼                        ▼
                          ┌───────────────────┐    ┌───────────────────┐
                          │StaticTileProvider │    │DynamicTileProvider│
                          │ Providers         │    │                   │
                          │ (tiled images)    │    │ (Procedural gen)  │
                          └───────────────────┘    └───────────────────┘
                                  │                    │
                                  │                    ▼
                                  │         ┌─────────────────┐
                                  │_______  │   TileStore     │
                                            │ (Disk storage)  │
                                            └─────────────────┘
</pre></div>
</div>
</section>
<section id="component-details">
<h2>Component Details<a class="headerlink" href="#component-details" title="Link to this heading">¶</a></h2>
<section id="tile">
<h3>Tile<a class="headerlink" href="#tile" title="Link to this heading">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">Tile</span></code> class is a wrapper around image data (QImage/PIL) providing operations
for manipulation and rendering.</p>
<p><strong>Key Operations:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">crop(bbox)</span></code>: Extract a rectangular region from the tile</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">resize(width,</span> <span class="pre">height)</span></code>: Scale the tile to new dimensions</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">save(filename)</span></code>: Write the tile to disk</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">draw(painter,</span> <span class="pre">x,</span> <span class="pre">y)</span></code>: Render the tile using a QPainter</p></li>
</ul>
<p><strong>Factory Functions:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">new(width,</span> <span class="pre">height)</span></code>: Create an empty tile</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fromstring(string,</span> <span class="pre">width,</span> <span class="pre">height)</span></code>: Create a tile from raw pixel data</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">merged(t1,</span> <span class="pre">t2,</span> <span class="pre">t3,</span> <span class="pre">t4)</span></code>: Combine four tiles into one (2×2 grid)</p></li>
</ul>
</section>
<section id="tiler">
<h3>Tiler<a class="headerlink" href="#tiler" title="Link to this heading">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">Tiler</span></code> class converts source images into pyramidal tile structures. It is an
abstract base class that runs as a separate thread.</p>
<p><strong>Tile Pyramid Structure:</strong></p>
<p>For an image with dimensions <code class="docutils literal notranslate"><span class="pre">W</span> <span class="pre">×</span> <span class="pre">H</span></code> and tile size <code class="docutils literal notranslate"><span class="pre">T</span></code>:</p>
<ul class="simple">
<li><p><strong>Maximum Tile Level</strong>: <code class="docutils literal notranslate"><span class="pre">maxtilelevel</span> <span class="pre">=</span> <span class="pre">ceil(log2(max(W,</span> <span class="pre">H)</span> <span class="pre">/</span> <span class="pre">T))</span></code></p></li>
<li><p><strong>Tiles at Level L</strong>: <code class="docutils literal notranslate"><span class="pre">ceil(W</span> <span class="pre">/</span> <span class="pre">(T</span> <span class="pre">×</span> <span class="pre">2^(maxtilelevel</span> <span class="pre">-</span> <span class="pre">L)))</span> <span class="pre">×</span> <span class="pre">ceil(H</span> <span class="pre">/</span> <span class="pre">(T</span> <span class="pre">×</span> <span class="pre">2^(maxtilelevel</span> <span class="pre">-</span> <span class="pre">L)))</span></code></p></li>
</ul>
<p><strong>Example:</strong> A 1024×1024 image with 256×256 tiles:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Level 0: 1 tile   (1×1)   - Overview
Level 1: 4 tiles  (2×2)   - 2× zoom
Level 2: 16 tiles (4×4)   - Full resolution

Total: 21 tiles
</pre></div>
</div>
<p><strong>Tiling Process:</strong></p>
<ol class="arabic simple">
<li><p><strong>Calculate Dimensions</strong>: Determine the number of tiles and pyramid levels</p></li>
<li><p><strong>Read Scanlines</strong>: Read the source image row by row using <code class="docutils literal notranslate"><span class="pre">_scanline()</span></code></p></li>
<li><p><strong>Create Base Tiles</strong>: Divide rows into tiles at the maximum level</p></li>
<li><p><strong>Merge Upward</strong>: Combine 2×2 tile groups to create lower-level tiles</p></li>
<li><p><strong>Save Tiles</strong>: Write each tile to disk via TileStore</p></li>
<li><p><strong>Write Metadata</strong>: Store image dimensions, tile size, and format</p></li>
</ol>
<p><strong>Subclasses:</strong></p>
<p>Concrete implementations must provide the <code class="docutils literal notranslate"><span class="pre">_scanline(y)</span></code> method to read image data:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">VIPSTiler</span></code>: Uses libvips for memory-efficient processing of large images</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">PPMTiler</span></code>: Reads PPM/PGM format images</p></li>
</ul>
</section>
<section id="tilestore">
<h3>TileStore<a class="headerlink" href="#tilestore" title="Link to this heading">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">TileStore</span></code> module manages disk-based tile storage and metadata persistence.</p>
<p><strong>Directory Structure:</strong></p>
<p>Tiles are organized by media ID using SHA1 hashing:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>~/.pyzui/tilestore/
└── &lt;sha1_hash_of_media_id&gt;/
    ├── metadata
    ├── 00/
    │   └── 00_000000_000000.jpg
    ├── 01/
    │   ├── 01_000000_000000.jpg
    │   ├── 01_000000_000001.jpg
    │   ├── 01_000001_000000.jpg
    │   └── 01_000001_000001.jpg
    └── 02/
        └── ...
</pre></div>
</div>
<p><strong>Tile Path Format:</strong></p>
<p><code class="docutils literal notranslate"><span class="pre">&lt;tilelevel&gt;/&lt;tilelevel&gt;_&lt;row&gt;_&lt;col&gt;.&lt;ext&gt;</span></code></p>
<p>Where row and column are zero-padded to 6 digits.</p>
<p><strong>Metadata File Format:</strong></p>
<p>Tab-separated values with type information:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">width</span>       <span class="mi">1024</span>    <span class="nb">int</span>
<span class="n">height</span>      <span class="mi">768</span>     <span class="nb">int</span>
<span class="n">tilesize</span>    <span class="mi">256</span>     <span class="nb">int</span>
<span class="n">filext</span>      <span class="n">jpg</span>     <span class="nb">str</span>
<span class="n">maxtilelevel</span>        <span class="mi">2</span>       <span class="nb">int</span>
</pre></div>
</div>
<p><strong>Key Functions:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">get_media_path(media_id)</span></code>: Get the directory for a media’s tiles</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">get_tile_path(tile_id,</span> <span class="pre">filext)</span></code>: Get the file path for a specific tile</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">load_metadata(media_id)</span></code>: Load metadata from disk into memory</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">get_metadata(media_id,</span> <span class="pre">key)</span></code>: Retrieve a metadata value</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">write_metadata(media_id,</span> <span class="pre">**kwargs)</span></code>: Write metadata to disk</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tiled(media_id)</span></code>: Check if a media has been fully tiled</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">get_tilestore_stats()</span></code>: Get statistics about the tilestore</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cleanup_old_tiles(max_age_days)</span></code>: Remove old tile directories</p></li>
</ul>
</section>
<section id="tilecache">
<h3>TileCache<a class="headerlink" href="#tilecache" title="Link to this heading">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">TileCache</span></code> class provides in-memory LRU (Least Recently Used) caching of tiles.</p>
<p><strong>Features:</strong></p>
<ul class="simple">
<li><p><strong>Size-Based Eviction</strong>: Automatically evicts tiles when <code class="docutils literal notranslate"><span class="pre">maxsize</span></code> is exceeded</p></li>
<li><p><strong>Age-Based Expiration</strong>: Optional <code class="docutils literal notranslate"><span class="pre">maxage</span></code> parameter for time-based eviction</p></li>
<li><p><strong>Access-Based Expiration</strong>: Tiles can expire after N accesses via <code class="docutils literal notranslate"><span class="pre">maxaccesses</span></code></p></li>
<li><p><strong>Immortal Tiles</strong>: Level 0 tiles (overview) are never evicted</p></li>
<li><p><strong>Thread Safety</strong>: RLock protects concurrent access</p></li>
</ul>
<p><strong>Dual-Tier Caching:</strong></p>
<p>The TileManager uses two caches:</p>
<ol class="arabic simple">
<li><p><strong>Permanent Cache (80%)</strong>: Stores tiles loaded from disk</p></li>
<li><p><strong>Temporary Cache (20%)</strong>: Stores synthesized/cut tiles that can be regenerated</p></li>
</ol>
</section>
<section id="tilemanager">
<h3>TileManager<a class="headerlink" href="#tilemanager" title="Link to this heading">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">TileManager</span></code> module coordinates tile requests between providers and caches.</p>
<p><strong>Initialization:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">tilemanager</span><span class="o">.</span><span class="n">init</span><span class="p">(</span>
    <span class="n">total_cache_size</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>     <span class="c1"># Total cache size in MB</span>
    <span class="n">auto_cleanup</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>        <span class="c1"># Enable automatic cleanup</span>
    <span class="n">cleanup_max_age_days</span><span class="o">=</span><span class="mi">7</span>    <span class="c1"># Remove tiles older than 7 days</span>
<span class="p">)</span>
</pre></div>
</div>
<p><strong>Key Functions:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">load_tile(tile_id)</span></code>: Request a tile to be loaded (asynchronous)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">get_tile(tile_id)</span></code>: Get a tile from cache (raises if not available)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">get_tile_robust(tile_id)</span></code>: Get tile with fallback to synthesis</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cut_tile(tile_id)</span></code>: Synthesize a tile from parent tiles</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tiled(media_id)</span></code>: Check if media is tiled</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">get_metadata(media_id,</span> <span class="pre">key)</span></code>: Get metadata for a media</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">purge(media_id=None)</span></code>: Remove tiles from providers and cache</p></li>
</ul>
<p><strong>Tile Synthesis (cut_tile):</strong></p>
<p>When a tile is not available, it can be synthesized from parent tiles:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Requested: (media, level=2, row=3, col=5)
Parent:    (media, level=1, row=1, col=2)

Parent tile is cropped to the correct quadrant:
┌─────┬─────┐
│ 0,0 │ 0,1 │  ← row=3 is odd, col=5 is odd
├─────┼─────┤     so we take bottom-right quadrant
│ 1,0 │*1,1*│
└─────┴─────┘

Then resized to full tile dimensions.
</pre></div>
</div>
<p><strong>Negative Tile Levels:</strong></p>
<p>Negative tile levels represent zoomed-out views beyond level 0:</p>
<ul class="simple">
<li><p>Level -1: 50% of level 0</p></li>
<li><p>Level -2: 25% of level 0</p></li>
<li><p>etc.</p></li>
</ul>
<p>These are created by resizing the (0,0,0) tile.</p>
</section>
<section id="tileproviders">
<h3>TileProviders<a class="headerlink" href="#tileproviders" title="Link to this heading">¶</a></h3>
<p>Tile providers are responsible for loading or generating tiles.</p>
<p><strong>Base Class: TileProvider</strong></p>
<p>Abstract base class running as a daemon thread. Provides:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">request(tile_id)</span></code>: Queue a tile load request (LIFO order)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">load(tile_id)</span></code>: Abstract method to load/generate a tile</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">purge(media_id=None)</span></code>: Cancel pending requests</p></li>
</ul>
<p><strong>StaticTileProvider</strong></p>
<p>Loads pre-tiled images from the TileStore:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tile</span> <span class="o">=</span> <span class="n">tilestore</span><span class="o">.</span><span class="n">load_tile</span><span class="p">(</span><span class="n">tile_id</span><span class="p">)</span>
<span class="n">cache</span><span class="p">[</span><span class="n">tile_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">tile</span>
</pre></div>
</div>
<p><strong>DynamicTileProvider</strong></p>
<p>Generates tiles procedurally (e.g., fractals, maps). Subclasses:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">FernTileProvider</span></code>: Barnsley fern fractal</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">MandelbrotTileProvider</span></code>: Mandelbrot set</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">OSMTileProvider</span></code>: OpenStreetMap tiles</p></li>
</ul>
</section>
</section>
<section id="tile-id-format">
<h2>Tile ID Format<a class="headerlink" href="#tile-id-format" title="Link to this heading">¶</a></h2>
<p>A tile is identified by a 4-tuple:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">media_id</span><span class="p">,</span> <span class="n">tilelevel</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li><p><strong>media_id</strong>: String identifying the source image or dynamic content</p></li>
<li><p><strong>tilelevel</strong>: Integer pyramid level (0 = overview, higher = more detail)</p></li>
<li><p><strong>row</strong>: Integer row index (0-based, top to bottom)</p></li>
<li><p><strong>col</strong>: Integer column index (0-based, left to right)</p></li>
</ul>
<p><strong>Examples:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">(&quot;photo.jpg&quot;,</span> <span class="pre">0,</span> <span class="pre">0,</span> <span class="pre">0)</span></code>: Overview tile of photo.jpg</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">(&quot;photo.jpg&quot;,</span> <span class="pre">2,</span> <span class="pre">3,</span> <span class="pre">5)</span></code>: Detail tile at level 2, row 3, column 5</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">(&quot;dynamic:fern&quot;,</span> <span class="pre">10,</span> <span class="pre">512,</span> <span class="pre">256)</span></code>: Procedurally generated fern tile</p></li>
</ul>
</section>
<section id="tile-request-flow">
<h2>Tile Request Flow<a class="headerlink" href="#tile-request-flow" title="Link to this heading">¶</a></h2>
<p>The following sequence describes how a tile is requested and delivered:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>1. Application requests tile via get_tile_robust(tile_id)
                │
                ▼
2. TileManager checks permanent cache
   ├─ Cache HIT → Return tile
   └─ Cache MISS → Continue
                │
                ▼
3. TileManager routes to appropriate provider
   ├─ &quot;dynamic:*&quot; → DynamicTileProvider
   └─ Otherwise  → StaticTileProvider
                │
                ▼
4. Provider loads/generates tile
   ├─ StaticTileProvider reads from TileStore
   └─ DynamicTileProvider generates procedurally
                │
                ▼
5. Tile is stored in cache
                │
                ▼
6. Tile is returned to application
</pre></div>
</div>
<p><strong>Fallback Synthesis:</strong></p>
<p>If a tile is not available (TileNotLoaded/TileNotAvailable), the system
attempts to synthesize it from parent tiles via <code class="docutils literal notranslate"><span class="pre">cut_tile()</span></code>.</p>
</section>
<section id="performance-considerations">
<h2>Performance Considerations<a class="headerlink" href="#performance-considerations" title="Link to this heading">¶</a></h2>
<p><strong>Memory Management:</strong></p>
<ul class="simple">
<li><p>The cache uses approximately 80/20 split between permanent and temporary tiles</p></li>
<li><p>LRU eviction prevents unbounded memory growth</p></li>
<li><p>Level 0 tiles are immortal (always kept) as they’re frequently accessed</p></li>
</ul>
<p><strong>Disk I/O:</strong></p>
<ul class="simple">
<li><p>Tiles are loaded lazily on demand</p></li>
<li><p>LIFO queue prioritizes recently requested tiles</p></li>
<li><p>Disk lock prevents concurrent write conflicts</p></li>
</ul>
<p><strong>Threading:</strong></p>
<ul class="simple">
<li><p>TileProviders run as daemon threads</p></li>
<li><p>RLocks protect shared state (caches, metadata)</p></li>
<li><p>Multiple providers can run concurrently</p></li>
</ul>
<p><strong>Recommended Settings:</strong></p>
<ul class="simple">
<li><p><strong>Cache Size</strong>: 200-500 MB for typical usage</p></li>
<li><p><strong>Tile Size</strong>: 256×256 for balance of overhead vs. granularity</p></li>
<li><p><strong>Auto-Cleanup</strong>: Enable with 7-30 day retention for disk management</p></li>
</ul>
</section>
<section id="exception-handling">
<h2>Exception Handling<a class="headerlink" href="#exception-handling" title="Link to this heading">¶</a></h2>
<p>The tiling system defines three exception types:</p>
<p><strong>MediaNotTiled</strong></p>
<p>Raised when accessing a media that hasn’t been tiled yet:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="n">tile</span> <span class="o">=</span> <span class="n">tilemanager</span><span class="o">.</span><span class="n">get_tile</span><span class="p">(</span><span class="n">tile_id</span><span class="p">)</span>
<span class="k">except</span> <span class="n">MediaNotTiled</span><span class="p">:</span>
    <span class="c1"># Need to tile the image first</span>
    <span class="n">start_tiling</span><span class="p">(</span><span class="n">media_path</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>TileNotLoaded</strong></p>
<p>Raised when a tile exists but isn’t in the cache yet:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="n">tile</span> <span class="o">=</span> <span class="n">tilemanager</span><span class="o">.</span><span class="n">get_tile</span><span class="p">(</span><span class="n">tile_id</span><span class="p">)</span>
<span class="k">except</span> <span class="n">TileNotLoaded</span><span class="p">:</span>
    <span class="c1"># Request tile load and wait or use cut_tile</span>
    <span class="n">tilemanager</span><span class="o">.</span><span class="n">load_tile</span><span class="p">(</span><span class="n">tile_id</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>TileNotAvailable</strong></p>
<p>Raised when a tile cannot be loaded (file missing, error, or <code class="docutils literal notranslate"><span class="pre">None</span></code> in cache):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="n">tile</span> <span class="o">=</span> <span class="n">tilemanager</span><span class="o">.</span><span class="n">get_tile</span><span class="p">(</span><span class="n">tile_id</span><span class="p">)</span>
<span class="k">except</span> <span class="n">TileNotAvailable</span><span class="p">:</span>
    <span class="c1"># Tile doesn&#39;t exist, synthesize from parent</span>
    <span class="n">tile</span> <span class="o">=</span> <span class="n">tilemanager</span><span class="o">.</span><span class="n">cut_tile</span><span class="p">(</span><span class="n">tile_id</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
<p><strong>Robust Access:</strong></p>
<p>Use <code class="docutils literal notranslate"><span class="pre">get_tile_robust()</span></code> for automatic fallback handling:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tile</span> <span class="o">=</span> <span class="n">tilemanager</span><span class="o">.</span><span class="n">get_tile_robust</span><span class="p">(</span><span class="n">tile_id</span><span class="p">)</span>
<span class="c1"># Never raises TileNotLoaded or TileNotAvailable</span>
</pre></div>
</div>
</section>
<section id="usage-example">
<h2>Usage Example<a class="headerlink" href="#usage-example" title="Link to this heading">¶</a></h2>
<p><strong>Tiling an Image:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pyzui.tilesystem.converters.vipsconverter</span><span class="w"> </span><span class="kn">import</span> <span class="n">VIPSTiler</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyzui.tilesystem</span><span class="w"> </span><span class="kn">import</span> <span class="n">tilestore</span><span class="p">,</span> <span class="n">tilemanager</span>

<span class="c1"># Initialize the tilemanager</span>
<span class="n">tilemanager</span><span class="o">.</span><span class="n">init</span><span class="p">(</span><span class="n">total_cache_size</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">auto_cleanup</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Tile an image</span>
<span class="n">tiler</span> <span class="o">=</span> <span class="n">VIPSTiler</span><span class="p">(</span><span class="s2">&quot;large_photo.tif&quot;</span><span class="p">,</span> <span class="n">media_id</span><span class="o">=</span><span class="s2">&quot;photo1&quot;</span><span class="p">,</span> <span class="n">tilesize</span><span class="o">=</span><span class="mi">256</span><span class="p">)</span>
<span class="n">tiler</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>  <span class="c1"># Run in background thread</span>
<span class="n">tiler</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>   <span class="c1"># Wait for completion</span>

<span class="k">if</span> <span class="n">tiler</span><span class="o">.</span><span class="n">error</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Tiling failed: </span><span class="si">{</span><span class="n">tiler</span><span class="o">.</span><span class="n">error</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Tiled successfully: </span><span class="si">{</span><span class="n">tilestore</span><span class="o">.</span><span class="n">get_metadata</span><span class="p">(</span><span class="s1">&#39;photo1&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;maxtilelevel&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2"> levels&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Retrieving Tiles:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Request tiles for display</span>
<span class="n">tile_id</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;photo1&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

<span class="c1"># Ensure tile is loaded</span>
<span class="n">tilemanager</span><span class="o">.</span><span class="n">load_tile</span><span class="p">(</span><span class="n">tile_id</span><span class="p">)</span>

<span class="c1"># Get tile (may need retry if loading is async)</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">tile</span> <span class="o">=</span> <span class="n">tilemanager</span><span class="o">.</span><span class="n">get_tile</span><span class="p">(</span><span class="n">tile_id</span><span class="p">)</span>
    <span class="n">tile</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">painter</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="k">except</span> <span class="n">TileNotLoaded</span><span class="p">:</span>
    <span class="c1"># Show placeholder, tile is loading</span>
    <span class="k">pass</span>
</pre></div>
</div>
<p><strong>Working with Dynamic Content:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Dynamic tiles are always &quot;tiled&quot;</span>
<span class="k">assert</span> <span class="n">tilemanager</span><span class="o">.</span><span class="n">tiled</span><span class="p">(</span><span class="s2">&quot;dynamic:fern&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">True</span>

<span class="c1"># Get procedurally generated tile</span>
<span class="n">tile</span> <span class="o">=</span> <span class="n">tilemanager</span><span class="o">.</span><span class="n">get_tile_robust</span><span class="p">((</span><span class="s2">&quot;dynamic:fern&quot;</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">))</span>

<span class="c1"># Metadata for dynamic content</span>
<span class="n">tilesize</span> <span class="o">=</span> <span class="n">tilemanager</span><span class="o">.</span><span class="n">get_metadata</span><span class="p">(</span><span class="s2">&quot;dynamic:fern&quot;</span><span class="p">,</span> <span class="s2">&quot;tilesize&quot;</span><span class="p">)</span>  <span class="c1"># 256</span>
<span class="n">maxlevel</span> <span class="o">=</span> <span class="n">tilemanager</span><span class="o">.</span><span class="n">get_metadata</span><span class="p">(</span><span class="s2">&quot;dynamic:fern&quot;</span><span class="p">,</span> <span class="s2">&quot;maxtilelevel&quot;</span><span class="p">)</span>  <span class="c1"># 18</span>
</pre></div>
</div>
</section>
<section id="api-reference">
<h2>API Reference<a class="headerlink" href="#api-reference" title="Link to this heading">¶</a></h2>
<p>For detailed API documentation, see:</p>
<ul class="simple">
<li><p><a class="reference internal" href="pyzui/tile.html"><span class="doc">pyzui.tilesystem.tile module</span></a></p></li>
<li><p><a class="reference internal" href="pyzui/tiler.html"><span class="doc">pyzui.tilesystem.tiler module</span></a></p></li>
<li><p><a class="reference internal" href="pyzui/tilestore.html"><span class="doc">pyzui.tilesystem.tilestore.tilestore module</span></a></p></li>
<li><p><a class="reference internal" href="pyzui/tilecache.html"><span class="doc">pyzui.tilesystem.tilestore.tilecache module</span></a></p></li>
<li><p><a class="reference internal" href="pyzui/tilemanager.html"><span class="doc">pyzui.tilesystem.tilemanager module</span></a></p></li>
<li><p><a class="reference internal" href="pyzui/tileprovider.html"><span class="doc">pyzui.tilesystem.tileproviders.tileprovider module</span></a></p></li>
</ul>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">PyZui</a></h1>








<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="installation.html">PyZui installation instructions</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html#dependencies">Dependencies</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html#running-pyzui">Running PyZUI</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html#generating-documentation">Generating Documentation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Usage Instructions</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="userinterface.html">User Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="programconfiguration.html">Program Configuration</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Technical Documentation</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="readingdocumentation.html">Reading Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="projectstructure.html">Project structure</a></li>
<li class="toctree-l1"><a class="reference internal" href="tiledmediaobject.html">Tiled media object</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Tiling System</a></li>
<li class="toctree-l1"><a class="reference internal" href="logging.html">Logging System</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Contribution Guidelines</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="contributiongiudelines.html">Contribution guidelines</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="tiledmediaobject.html" title="previous chapter">Tiled media object</a></li>
      <li>Next: <a href="logging.html" title="next chapter">Logging System</a></li>
  </ul></li>
</ul>
</div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2025, David Roberts, Andrea Silvestri.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 8.2.3</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 0.7.16</a>
      
      |
      <a href="_sources/tilingsystem.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>